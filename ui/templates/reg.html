<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/css/reg.css">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
</head>

<body>
    <h1>OZINSHE</h1>
    <div class="main">


                
        
        
        <div class="container">
            <div class="header">
                <div class="nav">
                    <div class="buttons">
        
                        <a href="/reg"><button>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button></a>
                        <a href="/mobile"><button>–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button></a>
                        <a href="/projects"><button>–ü—Ä–æ–µ–∫—Ç—ã</button></a>
                    </div>
                </div>
                
                
            </div>
            <div class="block">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <label for="email">–ü–æ—á—Ç–∞:</label><br>
            <input type="email" id="email" name="email" required oninput="validateInput()"><br>
            <div class="validationBlock">
                <div class="validationBlockEmail" id="validationBlockEmail"></div>
            </div>
            <label for="password">–ü–∞—Ä–æ–ª—å:</label><br>
            <input type="password" id="password" name="password" required oninput="validateInput()"><br>
            <div class="validationBlock">
                <div class="validationBlockPassword" id="validationBlockPassword"></div>
            </div>
            <label for="confirm_password">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è:</label><br>
            <input type="password" id="confirmPassword" name="confirmPassword" required oninput="validateInput()"><br>
            <div class="validationBlock">
                <div class="validationBlockPasswordC" id="validationBlockPasswordC"></div>
            </div>
            <div class="submitBlock">
                <input disabled   type="submit" onclick="submit()" id="submitButton" value="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è">

                <div class="loading" id="loading"></div>
            </div>
            
            

            
            <div class="validationBlock">
            </div>
            <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="/login">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</a>.</p>
        </div>
    </div>
</div>
</div>
</div>
</div>
</div>
    <script>
        validateInput()
        function validateInput() {
            let email = document.getElementById('email').value;
            let password = document.getElementById('password').value;
            let confirmPassword = document.getElementById('confirmPassword').value;
            
            const validationBlockEmail = document.getElementById('validationBlockEmail');
            const validationBlockPassword = document.getElementById('validationBlockPassword');
            const validationBlockPasswordC = document.getElementById('validationBlockPasswordC');
            validationBlockEmail.innerHTML = ''; // –æ—á–∏—â–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π
            validationBlockPassword.innerHTML = ''; // –æ—á–∏—â–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π
            validationBlockPasswordC.innerHTML = ''; // –æ—á–∏—â–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–æ–π

            // –í–∞–ª–∏–¥–∞—Ü–∏—è email
            if (!email) {
                validationBlockEmail.innerHTML += '<p>–ü–æ—á—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞</p>';
            } else if (!validateEmail(email)) {
                validationBlockEmail.innerHTML += '<p>–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–æ—á—Ç—ã</p>';
            }

            // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
            if (!password) {
                validationBlockPassword.innerHTML += '<p>–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω</p>';
            } else {
                if (!validatePasswordContainsUppercase(password)) {
                    validationBlockPassword.innerHTML += '<p>–•–æ—Ç—è –±—ã –æ–¥–Ω–∞ –±—É–∫–≤–∞ –≤—ã—Å—à–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞</p>';
                }
                if (!validatePasswordContainsLowercase(password)) {
                    validationBlockPassword.innerHTML += '<p>–•–æ—Ç—è –±—ã –æ–¥–Ω–∞ –±—É–∫–≤–∞ –Ω–∏–∂–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞</p>';
                }
                if (!validatePasswordContainsDigit(password)) {
                    validationBlockPassword.innerHTML += '<p>–•–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞</p>';
                }
                if (!validatePasswordContainsSpecialChar(password)) {
                    validationBlockPassword.innerHTML += '<p>–•–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª</p>';
                }
                if (password.length < 8) {
                    validationBlockPassword.innerHTML += '<p>–•–æ—Ç—è –±—ã 8 —Å–∏–º–≤–æ–ª–æ–≤</p>';
                }
            }

            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
            if (password !== confirmPassword) {
                validationBlockPasswordC.innerHTML += '<p>–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç</p>';
            }
            if ((validationBlockEmail.innerHTML !== '') || (validationBlockPassword.innerHTML !== '') || (validationBlockPasswordC.innerHTML !== '')) {
                submitButton.disabled = true
                submitButton.style.backgroundColor = 'gray'
            } else {
                submitButton.disabled = false
                submitButton.style.backgroundColor = 'blue'
            }
        }

        function validatePasswordContainsUppercase(password) {
            return /[A-Z]/.test(password);
        }

        function validatePasswordContainsLowercase(password) {
            return /[a-z]/.test(password);
        }

        function validatePasswordContainsDigit(password) {
            return /\d/.test(password);
        }

        function validatePasswordContainsSpecialChar(password) {
            return /[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/.test(password);
        }

        function validateEmail(email) {
            const re = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
            return re.test(String(email).toLowerCase());
        }

        function submit() {
            let email = document.getElementById('email').value;
            let password = document.getElementById('password').value;
            let confirmPassword = document.getElementById('confirmPassword').value;

            const data = {
                email: email,
                password: password,
                confirmPassword: confirmPassword,
            };

            const loading = document.getElementById('loading');
            const submitButton = document.getElementById('submitButton');

            loading.style.display = 'block';  // –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            submitButton.disabled = true;     // –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏

            fetch("/reg", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    loading.style.display = 'none'; // —Å–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                    submitButton.disabled = false;  // –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏

                    return response.json().then(json => {
                        if (!response.ok) {
                            throw new Error(`${response.status}: ${json.message}`);
                        }
                        return json;
                    });
                })
                .then(data => {
                    // alert(data.message || '–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è'); // –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    
                    showPopupNotification(data.message)
                    
                })
                .catch(error => {
                    showPopupNotification(error.message);
                });
        }
        function showPopupNotification(message) {
            const popupNotification = document.getElementById('popupNotification');
            const popupMessage = document.getElementById('popupMessage');

            popupMessage.textContent = message;
            popupNotification.style.display = 'block';

            setTimeout(() => {
                closePopupNotification();
            }, 4000); 
        }

        function closePopupNotification() {
            const popupNotification = document.getElementById('popupNotification');
            popupNotification.style.display = 'none';
        }
        document.addEventListener('DOMContentLoaded', () => {
    const toggleThemeButton = document.querySelector('.toggle-theme');
    const body = document.body;
    
    toggleThemeButton.addEventListener('click', () => {
        if (body.classList.contains('dark-mode')) {
            // Switch to light mode
            body.classList.remove('dark-mode');
            toggleThemeButton.textContent = 'üåô';
        } else {
            // Switch to dark mode
            body.classList.add('dark-mode');
            toggleThemeButton.textContent = '‚òÄÔ∏è';
        }
    });
});


    </script>
</body>
<div class="switch">
    <button class="toggle-theme">üåô</button>
</div>
<div id="popupNotification" class="popup-notification">
    <span class="close-popup" onclick="closePopupNotification()">&times;</span>
    <p id="popupMessage"></p>

</html>