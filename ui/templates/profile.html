<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/css/profile.css">
    <link rel="stylesheet" href="profile.css">

    <link rel="shortcut icon" href="static/images/icons/logo.png" type="image/x-icon">
    <title>Your profile</title>
    <script src="static/script/profile.js"></script>

</head>

<body>
    <a href="/">
        <h1>√ñZIN≈ûE</h1>
    </a>

    <div class="main">

        <div class="container">
            <div class="header">
                <div class="nav">
                    <div class="buttons">
                        <a href="/login"><button>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</button></a>
                        <a href="/reg"><button>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button></a>
                    </div>
                </div>


            </div>

            <div class="block">
                <p>Id: {{.Id}}</p>
                <p>Email: {{.Email}}</p>
                <p>Name: {{.Name}}</p>
                <p>Phone: {{.Phone}}</p>
                <p>Date of Birth: {{.DateOfBirth}}</p>
                <p>Role: {{.Role}}</p>

                <button onclick="openModal()">Edit</button>
            </div>


        </div>
    </div>
    </div>


    </div>




    </div>
    <script>
        function openModal() {
            document.getElementById('editModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }
    </script>
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <label>Name:</label>
            <input type="text" name="name" id="name" value="{{.Name}}">

            <label>Phone:</label>
            <input type="text" id="phone" name="phone" value="{{.Phone}}"
                oninput="this.value = this.value.replace(/[^0-9]/g, '').substring(0, 15)" maxlength="15" minlength="7">


            <label>Date of Birth:</label>
            <input type="date" name="dob" id="dob" value="{{.DateOfBirth}}">
            <input type="submit" onclick="sendPutRequest()" id="id" name="{{.Id}}" value="Save">
        </div>
    </div>
    <script>
        function sendPutRequest() {

            let url = `/api/profile`;
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
            let name = document.getElementById('name').value;
            let phone = document.getElementById('phone').value;
            let date_of_birth = document.getElementById('dob').value; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ ID –¥–ª—è –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è
            // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö
            if (phone[0] != '+') {
                phone = '+' + phone
            }
            let data = {
                name: name,
                phone: phone,
                date_of_birth: date_of_birth
            };
            let token = getToken()
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    return response.json();
                })
                .then(data => {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                    showPopupNotification(data.message)
                    closeModal(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                })
                .catch(error => {
                    showPopupNotification(data.message)
                    console.error('Fetch error:', error);
                });
        }

    </script>

    <div id="popupNotification" class="popup-notification">
        <span class="close-popup" onclick="closePopupNotification()">&times;</span>
        <p id="popupMessage"></p>
    </div>
    </div>
    <script>

    </script>
</body>




<div class="switch">
    <button class="toggle-theme">üåô</button>
</div>


</html>